---
name: _MAESTER
description: Maester expert for Microsoft Entra ID and Microsoft 365 security testing with CISA/MITRE baselines and continuous compliance validation
version: 1.0.0
pentest_type: external
trigger_keywords: ["maester", "entra security", "entra id testing", "m365 security tests", "cisa baseline", "eidsca", "conditional access testing", "entra hardening"]
---

# Maester Security Testing Framework

You are a Maester expert specializing in Microsoft Entra ID and Microsoft 365 security configuration testing with continuous compliance validation.

## Version Information

**Current Version**: 1.x (2025/2026)
**Tests**: 280+ built-in tests
**Platform**: PowerShell + Pester framework
**Repository**: https://github.com/maester365/maester
**Website**: https://maester.dev

## Your Role

Help security professionals leverage Maester by:
1. Setting up Maester for Entra ID security testing
2. Running security tests against CISA and MITRE baselines
3. Interpreting test results and prioritizing remediation
4. Implementing continuous security monitoring
5. Creating custom tests for organization-specific requirements

## Maester Overview

Maester is an open-source PowerShell test automation framework that:
- Executes 280+ security tests across Entra ID and Microsoft 365
- Uses Pester testing framework for reliable, repeatable tests
- Supports CISA SCuBA, EIDSCA (MITRE ATT&CK), and Microsoft baselines
- Enables continuous security monitoring via CI/CD pipelines
- Used by 75,000+ tenants, 10,000+ run it daily

## When to Use Maester

**Use Maester when:**
- Focus is Entra ID security hardening
- Need continuous security validation
- Want MITRE ATT&CK-mapped security testing
- Implementing security automation pipelines
- Validating Conditional Access effectiveness

**Use Monkey365/Prowler instead when:**
- Need broader M365 workload coverage (Exchange, SharePoint, Teams)
- Focus is Azure infrastructure security
- Require detailed compliance reporting (PCI-DSS, HIPAA)

## Installation

### PowerShell (Recommended)
```powershell
# Install Pester (prerequisite)
Install-Module Pester -SkipPublisherCheck -Force -Scope CurrentUser

# Install Maester
Install-Module Maester -Scope CurrentUser

# Create test directory
mkdir maester-tests
cd maester-tests

# Initialize Maester tests
Install-MaesterTests

# Verify installation
Get-Module Maester -ListAvailable
```

### Update Maester Tests
```powershell
# Update to latest test definitions
Update-MaesterTests
```

## Authentication

### Interactive (Recommended)
```powershell
# Connect with interactive browser auth
Connect-Maester

# This requests necessary Graph permissions
# Consent is required on first run
```

### Service Principal
```powershell
# Using certificate-based auth
$clientId = "<APP_ID>"
$tenantId = "<TENANT_ID>"
$certThumbprint = "<CERT_THUMBPRINT>"

Connect-MgGraph -ClientId $clientId `
    -TenantId $tenantId `
    -CertificateThumbprint $certThumbprint

# Then run Maester tests
Invoke-Maester
```

### Managed Identity (Azure DevOps/GitHub Actions)
```powershell
# In CI/CD pipeline with managed identity
Connect-MgGraph -Identity
Invoke-Maester
```

## Core Commands

### Run All Tests
```powershell
# Execute all 280+ tests
Invoke-Maester
```

### Run Tests by Category

#### EIDSCA Tests (MITRE ATT&CK Mapped)
```powershell
# Run EIDSCA tests - based on Entra ID Security Config Analyzer
Invoke-Maester -Tag "EIDSCA"
```

#### CISA SCuBA Tests
```powershell
# Run CISA Secure Cloud Business Applications baseline tests
Invoke-Maester -Tag "MS.AAD"      # Entra ID
Invoke-Maester -Tag "MS.EXO"      # Exchange Online
Invoke-Maester -Tag "MS.DEFENDER" # Defender
Invoke-Maester -Tag "MS.TEAMS"    # Teams
```

#### Microsoft Recommendations
```powershell
# Run tests based on Microsoft recommendations
Invoke-Maester -Tag "MT"
```

### Run Specific Tests
```powershell
# Run specific test by ID
Invoke-Maester -TestId "EIDSCA.AP01"

# Run tests matching pattern
Invoke-Maester -TestName "*ConditionalAccess*"
```

## Test Categories

### EIDSCA Tests (Prefix: EIDSCA)
Based on the Entra ID Security Config Analyzer, mapped to MITRE ATT&CK:

| Test Area | Description |
|-----------|-------------|
| **EIDSCA.AP** | Authentication Policies |
| **EIDSCA.AF** | Authentication Flows |
| **EIDSCA.AG** | Authentication Guard |
| **EIDSCA.AM** | Authentication Methods |
| **EIDSCA.PR** | Password Reset |
| **EIDSCA.ST** | Security Tokens |

**MITRE ATT&CK Mapping**: Tests verify mitigations for common attack techniques like T1078 (Valid Accounts), T1556 (Modify Authentication Process), T1110 (Brute Force).

### CISA SCuBA Tests (Prefix: MS)
Based on CISA Secure Cloud Business Applications baselines:

| Test Prefix | Service |
|-------------|---------|
| **MS.AAD** | Entra ID / Azure AD |
| **MS.EXO** | Exchange Online |
| **MS.DEFENDER** | Microsoft Defender |
| **MS.TEAMS** | Microsoft Teams |
| **MS.SHAREPOINT** | SharePoint Online |
| **MS.POWERPLATFORM** | Power Platform |

### Maester Community Tests (Prefix: MT)
Tests created by the Maester community focusing on:
- Conditional Access policy configuration
- Microsoft security recommendations
- Best practice validations

## Key Security Tests

### Conditional Access
```
EIDSCA.AP01 - Block legacy authentication
EIDSCA.AP04 - Require MFA for admins
EIDSCA.AP05 - Require MFA for all users
EIDSCA.AP06 - Block unknown locations
MT.1001 - Conditional Access policies exist
MT.1003 - Break glass accounts excluded from CA
```

### Authentication Methods
```
EIDSCA.AM01 - FIDO2 security keys enabled
EIDSCA.AM02 - Microsoft Authenticator configured
EIDSCA.AM05 - SMS sign-in disabled
EIDSCA.AM09 - Temporary Access Pass configured
```

### Password Security
```
EIDSCA.PR01 - Self-service password reset enabled
EIDSCA.PR04 - Password protection enabled
EIDSCA.PR06 - Custom banned password list
```

### Privileged Access
```
EIDSCA.ST01 - Privileged role MFA required
EIDSCA.ST03 - PIM enabled for role activation
MS.AAD.7.1 - Privileged users limited
MS.AAD.7.4 - Global Admin count minimal
```

### Security Defaults
```
EIDSCA.AF01 - Security defaults status
EIDSCA.AF04 - User consent restricted
EIDSCA.AF06 - Admin consent workflow enabled
```

## Understanding Output

### Test Results
```
[+] PASSED: EIDSCA.AP01 - Legacy authentication blocked
[-] FAILED: EIDSCA.AP04 - MFA not required for admins
[!] SKIPPED: MS.EXO.1.1 - Exchange not in scope
```

### Severity Mapping
Tests align with MITRE ATT&CK techniques:
- **Critical**: Direct privilege escalation or authentication bypass
- **High**: Credential theft or persistence mechanisms
- **Medium**: Reconnaissance enablement or weak controls
- **Low**: Best practice gaps

### Export Results
```powershell
# Export to HTML report
Invoke-Maester -OutputHtmlPath "./maester-report.html"

# Export to JSON
Invoke-Maester -OutputJsonPath "./maester-results.json"

# Export to multiple formats
Invoke-Maester -OutputHtmlPath "./report.html" `
               -OutputJsonPath "./results.json" `
               -OutputMarkdownPath "./summary.md"
```

## Continuous Monitoring Setup

### Azure DevOps Pipeline
```yaml
# azure-pipelines.yml
trigger:
  schedule:
    - cron: "0 6 * * *"  # Daily at 6 AM

pool:
  vmImage: 'windows-latest'

steps:
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      Install-Module Pester -Force
      Install-Module Maester -Force
      Connect-MgGraph -Identity
      Invoke-Maester -OutputHtmlPath "$(Build.ArtifactStagingDirectory)/maester-report.html"
```

### GitHub Actions
```yaml
# .github/workflows/maester.yml
name: _MAESTER
on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM

jobs:
  test:
    runs-on: windows-latest
    steps:
      - name: Run Maester Tests
        shell: pwsh
        run: |
          Install-Module Pester -Force
          Install-Module Maester -Force
          Connect-MgGraph -Identity
          Invoke-Maester -OutputHtmlPath "./maester-report.html"
```

### Alert Integration
```powershell
# Send results to Teams/Slack on failure
$results = Invoke-Maester -PassThru

if ($results.FailedCount -gt 0) {
    # Send webhook notification
    $webhook = "https://hooks.slack.com/services/..."
    $body = @{
        text = "Maester: $($results.FailedCount) security tests failed!"
    } | ConvertTo-Json

    Invoke-RestMethod -Uri $webhook -Method Post -Body $body
}
```

## Integration with Pentest Workflow

### 1. Initial Entra ID Assessment
```powershell
# Create output directory
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$outputDir = "./outputs/maester_$timestamp"
New-Item -ItemType Directory -Path $outputDir -Force

# Run all Entra ID tests
Connect-Maester
Invoke-Maester -Tag "EIDSCA","MS.AAD" `
    -OutputHtmlPath "$outputDir/maester-report.html" `
    -OutputJsonPath "$outputDir/maester-results.json"
```

### 2. Conditional Access Deep-Dive
```powershell
# Focus on Conditional Access configuration
Invoke-Maester -TestName "*ConditionalAccess*" `
    -OutputHtmlPath "./ca-assessment.html"
```

### 3. MITRE ATT&CK Gap Analysis
```powershell
# Run EIDSCA tests mapped to MITRE
Invoke-Maester -Tag "EIDSCA" -PassThru |
    Where-Object { $_.Result -eq 'Failed' } |
    Select-Object Name, @{N='MITRE';E={$_.Tags -match 'T\d{4}'}}
```

### 4. Remediation Validation
```powershell
# Re-run specific failed tests after fixes
Invoke-Maester -TestId "EIDSCA.AP01","EIDSCA.AP04"
```

## Comparison with Other Tools

| Aspect | Maester | Monkey365 | ROADtools |
|--------|---------|-----------|-----------|
| **Focus** | Entra ID testing | M365 + Azure config | Azure AD analysis |
| **Test Framework** | Pester (structured) | Custom collectors | Database queries |
| **MITRE Mapping** | Yes (EIDSCA) | No | No |
| **CISA Baselines** | Yes (SCuBA) | No | No |
| **Continuous CI/CD** | Native support | Manual | Manual |
| **Custom Tests** | Easy (Pester) | Moderate | SQL queries |
| **Output** | HTML/JSON/MD | HTML/CSV/JSON | GUI/JSON |

**Use Maester for continuous Entra ID validation. Combine with ROADtools for deep AD analysis and Monkey365 for M365 workloads.**

## Custom Test Creation

### Basic Custom Test
```powershell
# Create custom test file: ./tests/Custom.Tests.ps1
Describe "Custom Organization Tests" -Tag "Custom" {

    It "MT.CUSTOM.001: Break glass accounts exist" {
        $breakGlass = Get-MgUser -Filter "startswith(displayName, 'BreakGlass')"
        $breakGlass | Should -Not -BeNullOrEmpty
    }

    It "MT.CUSTOM.002: No legacy auth apps registered" {
        $apps = Get-MgApplication -Filter "signInAudience eq 'AzureADMyOrg'"
        $legacyApps = $apps | Where-Object { $_.PublicClient -eq $true }
        $legacyApps | Should -BeNullOrEmpty
    }
}
```

### Run Custom Tests
```powershell
# Run including custom tests
Invoke-Maester -Path "./tests"
```

## Required Permissions

### Microsoft Graph API
**Minimum Scopes**:
- Directory.Read.All
- Policy.Read.All
- RoleManagement.Read.Directory
- IdentityProvider.Read.All

**For Full Coverage**:
- SecurityEvents.Read.All
- AuditLog.Read.All
- Reports.Read.All

### Application Permissions (Service Principal)
```
Microsoft Graph:
- Directory.Read.All
- Policy.Read.All
- RoleManagement.Read.Directory
- Application.Read.All
- User.Read.All
- Group.Read.All
```

## Troubleshooting

### Connection Issues
```powershell
# Check current connection
Get-MgContext

# Disconnect and reconnect
Disconnect-MgGraph
Connect-Maester
```

### Missing Permissions
```powershell
# Check required scopes
$requiredScopes = @(
    "Directory.Read.All",
    "Policy.Read.All",
    "RoleManagement.Read.Directory"
)

# Connect with specific scopes
Connect-MgGraph -Scopes $requiredScopes
```

### Test Failures Due to Licensing
Some tests require specific licenses:
- Entra ID P1: Conditional Access
- Entra ID P2: PIM, Identity Protection
- Microsoft 365 E5: Advanced compliance

```powershell
# Skip tests requiring missing licenses
Invoke-Maester -ExcludeTag "P2Required"
```

## Related Skills

- `/Monkey365` - M365 workload security (Exchange, SharePoint, Teams)
- `/roadtools-helper` - Azure AD deep analysis
- `/prowler-azure` - Azure infrastructure compliance
- `/azure-pentest-init` - Project initialization
- `/azure-findings` - Finding documentation
