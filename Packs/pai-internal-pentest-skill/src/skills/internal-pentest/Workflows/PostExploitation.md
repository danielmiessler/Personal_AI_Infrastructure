# Phase 5: Post-Exploitation & Reporting

## Purpose
Evidence organization, finding documentation using Trace3 templates, executive summary, and remediation roadmap creation.

## When to Use
- Phase 5 of internal engagement
- User asks about reporting or documentation
- User wants to document a finding
- User needs to create deliverables

---

## Workflow

### Step 1: Evidence Organization

Verify all evidence directories are populated and organized:

```
outputs/
├── nmap/              # Port and service scans
│   ├── pingsweep_*.nmap/gnmap/xml
│   ├── service_scan_*.nmap/gnmap/xml
│   └── full_scan_*.nmap/gnmap/xml
├── bloodhound/        # BloodHound collections
│   └── *.zip
├── responder/         # Captured hashes
│   └── NTLMv2-*.txt
├── netexec/           # Enumeration output
│   ├── smb_enum.txt
│   ├── domain_users.txt
│   ├── shares.txt
│   └── spray_*.txt
├── certipy/           # ADCS analysis
│   └── certipy_*.txt
├── impacket/          # Attack output
│   ├── kerberoast_*.txt
│   ├── secretsdump_*.txt
│   └── dcsync_*.txt
├── sliver/            # C2 session data
└── screenshots/       # Evidence screenshots
```

### Step 2: Document Findings (Trace3 Format)

Create individual finding files in `Findings/` using kebab-case naming.

#### Trace3 Finding Template

```markdown
## [ID]: [Finding Title]

| | |
|---|---|
| **Severity** | [Critical/High/Medium/Low/Informational] |
| **Status** | Open |

[Opening paragraph: Clear 2-3 sentence description of what was found and its immediate implications.]

[Optional: Additional context paragraph if needed for technical explanation.]

### Business Impact

[1-2 paragraphs explaining organizational risk in business terms:
- What an attacker can achieve
- Compliance/regulatory implications
- Potential for lateral movement or escalation
- Impact on confidentiality, integrity, or availability]

### Remediation

[Specific, actionable steps to fix the issue]

- Step 1: [Action with specifics]
  - Sub-detail if needed
  - Configuration values or commands
- Step 2: [Next action]
- Step 3: [Verification step]

### References

- [Link to vendor documentation]
- [Link to security guidance]

### Notes

[Technical evidence section]

```bash
# Command that demonstrates the finding
[command here]
```

*[Caption describing what the output shows]*
```

#### Common Internal Pentest Findings (Templates)

**File: `Findings/llmnr-nbtns-poisoning.md`**
```markdown
## 001: LLMNR/NBT-NS Poisoning Enabled

| | |
|---|---|
| **Severity** | High |
| **Status** | Open |

Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are enabled across the internal network. These legacy name resolution protocols broadcast queries to the local network segment when DNS resolution fails, allowing any host on the network to respond with false information and capture authentication credentials.

During testing, [X] unique NTLMv2 hashes were captured from [Y] systems using Responder within [Z] minutes of monitoring.

### Business Impact

An attacker positioned on the internal network can passively intercept authentication credentials without any active exploitation. Captured NTLMv2 hashes can be cracked offline or relayed to other systems for immediate access. This technique requires minimal skill and is difficult to detect, making it a reliable initial access vector for both external threat actors and malicious insiders.

### Remediation

- Disable LLMNR via Group Policy:
  - Computer Configuration → Administrative Templates → Network → DNS Client → Turn off Multicast Name Resolution → **Enabled**
- Disable NBT-NS on all network interfaces:
  - Network adapter → TCP/IPv4 → Advanced → WINS → Disable NetBIOS over TCP/IP
  - Or via DHCP Option 001 (0x01)
- Deploy network detection for LLMNR/NBT-NS poisoning (e.g., Respounder)

### References

- https://attack.mitre.org/techniques/T1557/001/
- https://www.blackhillsinfosec.com/how-to-disable-llmnr-why-you-want-to/

### Notes

Responder was run on [INTERFACE] for [DURATION]:

```bash
sudo responder -I eth0 -wrFP -v
```

Captured [X] unique NTLMv2 hashes. [Y] were cracked, demonstrating weak password usage:

| User | Cracked Password | Source System |
|------|-----------------|---------------|
| [user1] | [password] | [host] |
```

**File: `Findings/smb-signing-disabled.md`**
```markdown
## 002: SMB Signing Not Required

| | |
|---|---|
| **Severity** | High |
| **Status** | Open |

SMB signing is not required on [X] of [Y] systems in the internal network. Without SMB signing enforcement, an attacker can perform SMB relay attacks by intercepting and forwarding authentication requests to other systems, gaining unauthorized access without knowing the user's password.

### Business Impact

SMB relay attacks allow an attacker to reuse intercepted authentication to execute commands on target systems. Combined with LLMNR/NBT-NS poisoning, this enables an attacker to gain administrative access to systems without cracking any passwords. This is a well-documented and reliable attack path commonly used in real-world intrusions.

### Remediation

- Enable SMB signing via Group Policy:
  - Computer Configuration → Policies → Windows Settings → Security Settings → Local Policies → Security Options
  - "Microsoft network server: Digitally sign communications (always)" → **Enabled**
  - "Microsoft network client: Digitally sign communications (always)" → **Enabled**
- Apply to all systems via domain GPO
- Verify: `netexec smb [HOST] | grep signing`

### References

- https://attack.mitre.org/techniques/T1557/001/
- https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/overview-server-message-block-signing

### Notes

SMB signing check across all discovered hosts:

```bash
netexec smb targets/live-hosts.txt --gen-relay-list targets/smb-no-signing.txt
```

[X] hosts without SMB signing enforced (see `targets/smb-no-signing.txt`).
```

**File: `Findings/domain-admin-compromise.md`**
```markdown
## 003: Domain Administrator Compromise Achieved

| | |
|---|---|
| **Severity** | Critical |
| **Status** | Open |

Full Active Directory domain compromise was achieved during the assessment. Starting from [starting_position], the testing team was able to obtain Domain Administrator credentials through [brief attack chain description]. This demonstrates that the current security controls are insufficient to prevent a determined attacker from achieving complete control over the domain.

### Business Impact

Domain Administrator access grants complete control over all Active Directory-joined systems, user accounts, group policies, and data. An attacker with this level of access can read, modify, or destroy any data in the environment, create persistent backdoor accounts, intercept all communications, and deploy ransomware across the entire domain simultaneously. This represents a complete compromise of the Windows environment.

### Remediation

Address each step in the attack chain:
1. [Remediation for initial access vector]
2. [Remediation for lateral movement]
3. [Remediation for privilege escalation]

Additionally:
- Implement tiered administration model (Tier 0/1/2)
- Deploy Privileged Access Workstations (PAWs)
- Enable Protected Users group for privileged accounts
- Implement LAPS for local administrator passwords
- Review and reduce Domain Admin membership

### References

- https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-deployment
- https://attack.mitre.org/tactics/TA0004/

### Notes

Attack path summary:

1. [Step 1 with evidence]
2. [Step 2 with evidence]
3. [Step 3 with evidence]

```bash
# Final DCSync demonstrating DA access
impacket-secretsdump -just-dc-user krbtgt 'DOMAIN/Administrator:[hash]@DC_IP'
```
```

---

### Step 3: Update Findings/README.md

Update with all documented findings:

```markdown
## Finding Summary

| Severity | Count | Status |
|----------|-------|--------|
| Critical | X | Open |
| High | X | Open |
| Medium | X | Open |
| Low | X | Open |
| Informational | X | Open |

## Findings Index

### Critical Severity
| Finding | File | Evidence | Status |
|---------|------|----------|--------|
| Domain Admin Compromise | `domain-admin-compromise.md` | `outputs/impacket/dcsync_*.txt` | CONFIRMED |
| ADCS ESC1 Template Abuse | `adcs-esc1-template-abuse.md` | `outputs/certipy/` | CONFIRMED |

### High Severity
| Finding | File | Evidence | Status |
|---------|------|----------|--------|
| LLMNR/NBT-NS Poisoning | `llmnr-nbtns-poisoning.md` | `outputs/responder/` | CONFIRMED |
| SMB Signing Disabled | `smb-signing-disabled.md` | `targets/smb-no-signing.txt` | CONFIRMED |
| Kerberoastable Accounts | `kerberoastable-accounts.md` | `outputs/impacket/kerberoast_*.txt` | CONFIRMED |
```

### Step 4: Update Validation Matrix

```markdown
## Validation Matrix

| Finding | Nmap | NetExec | BloodHound | Responder | Certipy | Manual | Confidence |
|---------|------|---------|------------|-----------|---------|--------|------------|
| LLMNR Poisoning | - | - | - | **POC** | - | - | **100%** |
| SMB Signing | - | ✓ | - | - | - | **POC** | **100%** |
| ADCS ESC1 | - | - | ✓ | - | **POC** | **POC** | **100%** |
| DA Compromise | - | ✓ | ✓ | ✓ | ✓ | **POC** | **100%** |
```

---

### Step 5: Create Executive Summary

Create `EXECUTIVE_SUMMARY.md`:

```markdown
# [CLIENT] Internal Penetration Test - Executive Summary

## Assessment Overview

| | |
|---|---|
| **Assessment Type** | Internal Penetration Test |
| **Dates** | [start_date] - [end_date] |
| **Scope** | [network_ranges] |
| **Domain** | [domain_name] |
| **Access Method** | [Physical / VPN] |
| **Starting Position** | [Black box / Assumed breach - standard user] |

## Overall Risk Rating: [CRITICAL / HIGH / MEDIUM / LOW]

## Finding Summary

| Severity | Count |
|----------|-------|
| Critical | X |
| High | X |
| Medium | X |
| Low | X |
| Informational | X |

## Attack Path Summary

[2-3 paragraph narrative describing how the testing team progressed from initial access to domain compromise. Include timeline and key pivot points. Write for a non-technical executive audience.]

## Top Risks

1. **[Finding Title]** (Critical) - [One sentence business impact]
2. **[Finding Title]** (High) - [One sentence business impact]
3. **[Finding Title]** (High) - [One sentence business impact]
4. **[Finding Title]** (Medium) - [One sentence business impact]

## Strategic Recommendations

### Immediate (0-24 Hours)
1. [Top priority remediation action]

### Short-Term (1-2 Weeks)
1. [Security improvement]
2. [Security improvement]

### Medium-Term (1-3 Months)
1. [Architectural improvement]
2. [Process improvement]

### Long-Term (3-6 Months)
1. [Strategic initiative]
```

---

### Step 6: Create Remediation Roadmap

Create `REMEDIATION_ROADMAP.md`:

```markdown
# [CLIENT] - Remediation Roadmap

## Phase Overview

| Phase | Timeline | Focus | Items |
|-------|----------|-------|-------|
| **Phase 1** | 0-24h | Critical credential/identity issues | X |
| **Phase 2** | 24-72h | Network protocol hardening | X |
| **Phase 3** | 1-2 weeks | AD hardening, ADCS, delegation | X |
| **Phase 4** | 2-4 weeks | Detection, monitoring, policy | X |

---

## Phase 1: Immediate (0-24 Hours)

### 1.1 [Finding Title]
**Finding**: `[finding-file].md`
**Risk**: CRITICAL - [Brief risk statement]

**Actions**:
- [Specific remediation step]
- [Configuration change]

**Verification**:
- [How to verify the fix]

---

## Phase 2: Urgent (24-72 Hours)

### 2.1 Disable LLMNR/NBT-NS
**Finding**: `llmnr-nbtns-poisoning.md`
**Risk**: HIGH - Credential interception on internal network

**Actions**:
- Deploy GPO: Turn off Multicast Name Resolution → Enabled
- Disable NetBIOS over TCP/IP via DHCP option 001

**Verification**:
- Run Responder and confirm no responses received

### 2.2 Enforce SMB Signing
**Finding**: `smb-signing-disabled.md`
**Risk**: HIGH - SMB relay attacks possible

**Actions**:
- GPO: Digitally sign communications (always) → Enabled (both server and client)
- Apply to all OUs

**Verification**:
- `netexec smb [HOST]` should show "signing: True"

---

## Phase 3: Short-Term (1-2 Weeks)

### 3.1 ADCS Template Hardening
- Remove enrollee-supplies-subject flag
- Restrict enrollment permissions
- Remove dangerous EKUs

### 3.2 Deploy LAPS
- Install LAPS agent on all workstations
- Configure password rotation policy
- Restrict LAPS read access

### 3.3 Review Delegation Settings
- Remove unconstrained delegation from non-DC systems
- Audit constrained delegation configurations
- Set ms-DS-MachineAccountQuota to 0

---

## Phase 4: Medium-Term (2-4 Weeks)

### 4.1 Implement Tiered Administration
- Separate Tier 0 (DC), Tier 1 (servers), Tier 2 (workstations) admin accounts
- Deploy PAWs for Tier 0 administration

### 4.2 Enhance Password Policy
- Minimum 14+ characters
- Implement fine-grained password policies for privileged accounts
- Deploy banned password list

### 4.3 Deploy Detection Rules
- LLMNR/NBT-NS poisoning detection
- Kerberoasting detection (4769 events with RC4)
- DCSync detection (4662 events)
- Unusual lateral movement patterns

---

## Verification Checklist

### Phase 1
- [ ] [Item] remediated and tested
- [ ] [Item] remediated and tested

### Phase 2
- [ ] LLMNR disabled and verified
- [ ] SMB signing enforced and verified

### Phase 3
- [ ] ADCS templates hardened
- [ ] LAPS deployed to all workstations
- [ ] Delegation settings reviewed

### Phase 4
- [ ] Tiered admin model implemented
- [ ] Password policy updated
- [ ] Detection rules deployed and tested
```

---

## Finding Severity Assignment Guide

| Severity | Criteria | Examples |
|----------|----------|---------|
| **Critical** | Immediate domain compromise, trivial exploit, no barriers | DA via ADCS ESC1, DCSync rights, unpatched RCE |
| **High** | Credential capture, significant lateral movement, privilege escalation | LLMNR poisoning, SMB relay, Kerberoast with cracked hash |
| **Medium** | Increases attack surface, violates best practices, chaining potential | Weak password policy, no LAPS, NTLMv1 allowed |
| **Low** | Limited direct impact, hygiene issue | No account lockout monitoring, stale accounts |
| **Informational** | Observation, architecture note | Network topology notes, technology inventory |

---

## Deliverables Checklist

- [ ] Individual finding files in `Findings/` (Trace3 format)
- [ ] `Findings/README.md` with index and validation matrix
- [ ] `EXECUTIVE_SUMMARY.md` with risk rating
- [ ] `REMEDIATION_ROADMAP.md` with 4-phase timeline
- [ ] Notes.md with complete attack path
- [ ] All evidence organized in `outputs/`
